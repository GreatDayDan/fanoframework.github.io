<!DOCTYPE html>
<!--
Hyperspace by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Deploy as CGI application - Fano Framework</title>
    <meta charset="utf-8" />
    <meta name="description" content="Tutorial on how to deploy CGI web application built with Fano Framework to various web servers.">
    <meta name="keywords" content="fano, web application, framework, pascal, programming, language, free pascal">
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="Deploy as CGI application"/>
    <meta property="og:site_name" content="Fano Framework"/>
    <meta property="og:url" content="http://localhost:4000/deployment/cgi/"/>
    <meta property="og:description" content="Tutorial on how to deploy CGI web application built with Fano Framework to various web servers."/>
    <meta property="og:type" content="website"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">


<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">
        <nav>
            <ul>
                
                    <h3>Getting Started</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                          <li><a href="/tutorials">Step By Step Tutorials</a></li>
                        
                      </ul>
                
                    <h3>Basic</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                      </ul>
                
            </ul>
        </nav>
    </div>
</section>


<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">Deployment as CGI application</h1>

<h2 id="deploy-with-fano-cli">Deploy with Fano CLI</h2>

<p>Simplest way to setup Fano web application with web server is to deploy CGI application with <a href="https://github.com/fanoframework/fano-cli">Fano CLI</a>, run with <code class="highlighter-rouge">--deploy-cgi=[domain name]</code>.</p>

<p>Inside Fano web application project directory, run</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo fanocli --deploy-cgi=myapp.me
</code></pre></div></div>

<p>Command above, will create virtual host for Apache web server, enabled virtual host configuration, reload Apache web server configuration and add entry to <code class="highlighter-rouge">myapp.me</code> domain in <code class="highlighter-rouge">/etc/hosts</code>.</p>

<h2 id="apache">Apache</h2>

<p>This section explains how to deploy web application as CGI application on Apache web server.</p>

<h3 id="dedicated-server">Dedicated server</h3>

<p>This section explains how to deploy server that you have full control and administrative privilege (aka root access).</p>

<h4 id="debian-based-linux">Debian-based Linux</h4>

<ul>
  <li>Create virtual host by adding Apache configuration file inside <code class="highlighter-rouge">/etc/apache2/sites-available</code> and put</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
    ServerAdmin [[server administrator email]]
    ServerName [[fano application hostname]]

    DocumentRoot "[[/path/to/fano/app/public]]"

    &lt;Directory "[[/path/to/fano/app/public]]"&gt;
        Options -MultiViews +ExecCGI
        AllowOverride FileInfo Indexes
        Require all granted
        AddHandler cgi-script .cgi
        DirectoryIndex app.cgi
     &lt;/Directory&gt;
 &lt;/VirtualHost&gt;
</code></pre></div></div>

<p>Replace <code class="highlighter-rouge">[[server administrator email]]</code> with administrator email for example, if we use domain name <code class="highlighter-rouge">fano.dev</code> we can use <code class="highlighter-rouge">admin@fano.dev</code>.</p>

<p>Replace <code class="highlighter-rouge">[[fano application hostname]]</code> with domain that we use,
for example in this case, it is <code class="highlighter-rouge">fano.dev</code>. So when Apache receive request with URI http://fano.dev/test it will match
this virtual host entry and call our application.</p>

<p>Replace <code class="highlighter-rouge">[[/path/to/fano/app/public]]</code> with directory where our application binary reside. If you store it outside Apache
document root directory, you need to specify with with <code class="highlighter-rouge">&lt;Directory&gt;</code>.</p>

<p>For example, if we store application binary in directory <code class="highlighter-rouge">/home/myuser/myapp/public</code> which outside Apache document root, we need to
add <code class="highlighter-rouge">Require</code> directive to allow Apache to serve request from
this directory, otherwise they will be rejected.</p>

<p>Above snippet basically tells Apache to allow (<code class="highlighter-rouge">+ExecCGI</code>) to serve any file ends with <code class="highlighter-rouge">cgi</code> extension as CGI script (<code class="highlighter-rouge">AddHandler cgi-script .cgi</code>). <code class="highlighter-rouge">-MultiViews</code> also important to disable automatic content negotiation because we need to add URL rewriting to allow use of routing in our application. So Our application will be responsible to decide what response to return.</p>

<p>So in our example, we end up with following configuration:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
    ServerAdmin admin@fano.dev
    ServerName fano.dev

    DocumentRoot "/home/myuser/myapp/public"

    &lt;Directory "/home/myuser/myapp/public"&gt;
        Options -MultiViews +ExecCGI
        AllowOverride FileInfo Indexes
        Require all granted
        AddHandler cgi-script .cgi
        DirectoryIndex app.cgi
     &lt;/Directory&gt;
 &lt;/VirtualHost&gt;
</code></pre></div></div>

<p>You need to make sure that <code class="highlighter-rouge">app.cgi</code> has execution bit. Read <em>Executable binary file permission</em> in <a href="/deployment">Deployment</a> for more information.</p>

<p>Save it as <code class="highlighter-rouge">fano.conf</code> file. Note that saving data to <code class="highlighter-rouge">/etc/apache2/sites-available</code> directory requires administrative privilege.</p>

<ul>
  <li>Enable virtual host</li>
</ul>

<p>To make our virtual host active, put symlink in <code class="highlighter-rouge">/etc/apache2/sites-enabled</code> that points to <code class="highlighter-rouge">/etc/apache2/sites-available/fano.conf</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo ln -s /etc/apache2/sites-available/fano.conf /etc/apache2/sites-enabled/fano.conf
</code></pre></div></div>
<p>or you can use <code class="highlighter-rouge">a2ensite</code> utility that comes with Debian distribution which does same thing.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo a2ensite fano.conf
</code></pre></div></div>

<ul>
  <li>Reload Apache service</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo service apache2 reload
</code></pre></div></div>

<p>If configuraton is ok, Apache will load new configuration.</p>

<ul>
  <li>Setup domain name to DNS</li>
</ul>

<p>If you have not register a domain name with domain name registrar, you can setup fake domain name for local development only by adding
entry to <code class="highlighter-rouge">/etc/hosts</code> file. Open <code class="highlighter-rouge">/etc/hosts</code> and add following entry,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 fano.dev
</code></pre></div></div>

<p><code class="highlighter-rouge">127.0.0.1</code> with assumption that Apache run on same machine.</p>

<h4 id="fedora-based-linux">Fedora-based Linux</h4>

<p>The difference between Debian and Fedora regarding Apache mostly about default service name (Debian uses <code class="highlighter-rouge">apache2</code> and Fedora uses <code class="highlighter-rouge">httpd</code>), user which Apache run (Debian uses <code class="highlighter-rouge">www-data</code> user while Fedora uses <code class="highlighter-rouge">apache</code>) and default Apache configuration location.</p>

<ul>
  <li>Create virtual host</li>
</ul>

<p>Apache main configuration is stored in <code class="highlighter-rouge">/etc/httpd/httpd.conf</code>. To add virtual host configuration, you can simply add entry to this file or prefered way is to create configuration in file <code class="highlighter-rouge">/etc/httpd/conf.d/</code> directory.</p>

<p>In Fedora and Apache 2.4, <code class="highlighter-rouge">/etc/httpd/conf.d/</code> directory will be search for additional configurations. So you can just create virtual host file inside this directory.</p>

<ul>
  <li>Reload Apache service</li>
</ul>

<p>Tell Apache to load configuration by running</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl reload httpd
</code></pre></div></div>

<h3 id="shared-hosting">Shared-hosting</h3>

<p>This section explains how to deploy server that you have no full control and have very limited administrative privelege.</p>

<h4 id="debian-based-linux-1">Debian-based Linux</h4>

<h4 id="fedora-based-linux-1">Fedora-based Linux</h4>

<h4 id="cpanel-based-server">CPanel-based server</h4>

<h2 id="nginx">Nginx</h2>

<p>This section explains how to deploy web application as CGI application on Nginx web server.</p>

<h2 id="simulate-run-on-command-line">Simulate run on command line</h2>

<p>If you use Fano CLI to generate CGI web application, it will add
<code class="highlighter-rouge">tools/simulate.run.sh</code> bash script. It can be used to simplify simulating run application in shell.</p>

<p>For example,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./tools/simulate.run.sh
</code></pre></div></div>

<p>or to change route to access, set <code class="highlighter-rouge">REQUEST_URI</code> variable.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ REQUEST_URI=/test/test ./simulate.run.sh
</code></pre></div></div>

<p>or more elaborate call,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd app/public
$ REQUEST_METHOD=GET \
  REQUEST_URI=/test/test \
  SERVER_NAME=juhara.com \
  ./app.cgi
</code></pre></div></div>

<p>This is similar to simulating browser requesting this page,for example,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget -O- http://[your fano app hostname]/test/test
</code></pre></div></div>

<p>However, running using <code class="highlighter-rouge">tools/simulate.run.sh</code> allows you to view output of <code class="highlighter-rouge">heaptrc</code> unit for detecting memory leak (if you enable <code class="highlighter-rouge">-gh</code> switch in <code class="highlighter-rouge">build.dev.cfg</code>).</p>

<h2 id="explore-more">Explore more</h2>

<ul>
  <li><a href="/deployment">Deployment</a></li>
  <li><a href="/scaffolding-with-fano-cli">Scaffolding with Fano CLI</a></li>
</ul>

<ul class="actions">
    <li><a href="/documentation" class="button">Documentation</a></li>
</ul>

        </div>
    </section>
</div>


    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

</body>
</html>

