<!DOCTYPE html>
<!--
Hyperspace by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>CGI Environment - Fano Framework</title>
    <meta charset="utf-8" />
    <meta name="description" content="Tutorial on how to work with CGI Environment">
    <meta name="keywords" content="fano, web application, framework, pascal, programming, language, free pascal">
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="CGI Environment"/>
    <meta property="og:site_name" content="Fano Framework"/>
    <meta property="og:url" content="http://localhost:4000/environment/"/>
    <meta property="og:description" content="Tutorial on how to work with CGI Environment"/>
    <meta property="og:type" content="website"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">


<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">
        <nav>
            <ul>
                
                    <h3>Getting Started</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                          <li><a href="/tutorials">Step By Step Tutorials</a></li>
                        
                      </ul>
                
                    <h3>Basic</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                      </ul>
                
            </ul>
        </nav>
    </div>
</section>


<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">CGI Environment</h1>

<h2 id="about-environment">About environment</h2>

<p>When our application run as CGI, FastCGI or SCGI application, it will receive environment variables from web server. CGI Environment variables are part of
CGI protocol. <a href="https://tools.ietf.org/html/rfc3875">See RFC 3875</a> for more information about CGI environment variables.</p>

<p>In Fano Framework, environment variable is encapsulated in <code class="highlighter-rouge">ICGIEnvironment</code> interface.</p>

<p>You can get <code class="highlighter-rouge">ICGIEnvironment</code> interface instance inside controller from <code class="highlighter-rouge">IRequest</code> interface instance through property <code class="highlighter-rouge">env</code> or method <code class="highlighter-rouge">getEnvironment()</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
function TMyController.handleRequest(
    const request : IRequest;
    const response : IResponse;
    const args : IRouteArgsReader
) : IResponse;
var myEnv : ICGIEnvironment;
begin
    myEnv := request.env;
    ...
end;
</code></pre></div></div>

<p>Read <a href="/working-with-controllers">Working with Controllers</a> for more information about <code class="highlighter-rouge">handleRequest()</code> method.</p>

<h2 id="icgienvironment-interface">ICGIEnvironment interface</h2>

<p><code class="highlighter-rouge">ICGIEnvironment</code> interface provides several methods for reading CGI environment variables but most important is <code class="highlighter-rouge">env()</code> method. Other methods basically just
act as helper method which actually use <code class="highlighter-rouge">env()</code>  under the hood. Look at <a href="https://github.com/fanoframework/fano/blob/master/src/Environment/Contracts/EnvironmentIntf.pas">ICGIEnvironment source</a> for more information on available methods.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function env(const keyName : string) : string;
</code></pre></div></div>

<p>It retrieves single environment variable value using its name.</p>

<h2 id="retrieving-environment-variables">Retrieving environment variables</h2>

<h3 id="get-client-ip-address">Get client IP address</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    ipAddr : string;
...
ipAddr := myEnv.env('REMOTE_ADDR');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipAddr := myEnv.remoteAddr();
</code></pre></div></div>

<h3 id="get-host">Get host</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    ipAddr : string;
...
host := myEnv.env('HTTP_HOST');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host := myEnv.httpHost();
</code></pre></div></div>

<h3 id="get-request-scheme">Get request scheme</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    scheme : string;
...
scheme := myEnv.env('REQUEST_SCHEME');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scheme := myEnv.requestScheme();
</code></pre></div></div>
<p>For example, <code class="highlighter-rouge">scheme</code> will contains <code class="highlighter-rouge">https</code> if your application is invoked via HTTPS protocol.</p>

<h3 id="get-request-method">Get request method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    method : string;
...
method := myEnv.env('REQUEST_METHOD');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>method := myEnv.requestMethod();
</code></pre></div></div>
<p>For example, <code class="highlighter-rouge">method</code> will contains <code class="highlighter-rouge">GET</code> if your application is invoked via HTTP GET.</p>

<h3 id="get-query-string">Get query string</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    query : string;
...
query := myEnv.env('QUERY_STRING');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query := myEnv.queryString();
</code></pre></div></div>

<h3 id="get-user-agent">Get user agent</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    browser : string;
...
browser := myEnv.env('HTTP_USER_AGENT');
</code></pre></div></div>

<p>or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>browser := myEnv.httpUserAgent();
</code></pre></div></div>

<h2 id="built-in-icgienvironment-implementation">Built-in ICGIEnvironment implementation</h2>

<p>Fano Framework provides several built-in implementation of ICGIEnvironment.</p>

<ul>
  <li><code class="highlighter-rouge">TCGIEnvironment</code> class which get environment variables thorough <code class="highlighter-rouge">GetEnvironmentVariable()</code> function from Free Pascal <code class="highlighter-rouge">SysUtils</code> unit. For CGI application, this is what you use.</li>
  <li><code class="highlighter-rouge">TKeyValueEnvironment</code> class which get environment variables thorough key value pair. For FastCGI or SCGI application, this is what you use.</li>
</ul>

<h2 id="enumerate-all-environment-variables">Enumerate all environment variables</h2>

<p>Sometime you want to know all current environment variables that web server sends to application. For example <code class="highlighter-rouge">TErrorHandler</code> class needs to be able to dump all environment variables. See <a href="https://github.com/fanoframework/fano/blob/master/src/Error/ErrorHandlerImpl.pas">TErrorHandler source</a>.</p>

<p>To be able to enumerate all available variables, you need to use <code class="highlighter-rouge">ICGIEnvironmentEnumerator</code> interface. You get this interface instance from <code class="highlighter-rouge">ICGIEnvironment</code> interface through its <code class="highlighter-rouge">enumerator</code> property or <code class="highlighter-rouge">getEnumerator()</code> method.</p>

<p>Environment enumerator provides three methods which enables developer to iterate all environment variables.</p>

<ul>
  <li><code class="highlighter-rouge">count()</code> returns number of environment variables.</li>
  <li><code class="highlighter-rouge">getKey()</code> returns environment variable name using zero-based index.</li>
  <li><code class="highlighter-rouge">getValue()</code> returns environment variable value using zero-based index.</li>
</ul>

<p>Read <a href="https://github.com/fanoframework/fano/blob/master/src/Environment/Contracts/EnvironmentEnumeratorIntf.pas">ICGIEnvironmentEnumerator source</a> for more information.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var myEnv : ICGIEnvironment;
    envEnum : ICGIEnvironmentEnumerator;
    indx : integer;
    varName, varValue : string;
...
envEnum := myEnv.enumerator;
for indx := 0 to envEnum.count-1 do
begin
    varName := envEnum.getKey(indx);
    varValue := envEnum.getValue(indx);
end;

</code></pre></div></div>

<h2 id="explore-more">Explore more</h2>

<ul>
  <li><a href="/dispatcher">Dispatcher</a></li>
  <li><a href="/error-handler">Error Handler</a></li>
</ul>

<ul class="actions">
    <li><a href="/documentation" class="button">Documentation</a></li>
</ul>

        </div>
    </section>
</div>


    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

</body>
</html>

