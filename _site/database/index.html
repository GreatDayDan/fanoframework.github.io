<!DOCTYPE html>
<!--
Hyperspace by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Working with Database - Fano Framework</title>
    <meta charset="utf-8" />
    <meta name="description" content="Working with database in Fano Framework">
    <meta name="keywords" content="fano, web application, framework, pascal, programming, language, free pascal">
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="Working with Database"/>
    <meta property="og:site_name" content="Fano Framework"/>
    <meta property="og:url" content="http://localhost:4000/database/"/>
    <meta property="og:description" content="Working with database in Fano Framework"/>
    <meta property="og:type" content="website"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">


<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">
        <nav>
            <ul>
                
                    <h3>Getting Started</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                          <li><a href="/tutorials">Step By Step Tutorials</a></li>
                        
                      </ul>
                
                    <h3>Basic</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                      </ul>
                
            </ul>
        </nav>
    </div>
</section>


<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">Working with Database</h1>

<h2 id="irdbms-interface">IRdbms interface</h2>

<p>IRdbms is just a thin wrapper for Free Pascal SQLdb package. Currently supported RDBMS system is</p>

<ul>
  <li>MySQL via <code class="highlighter-rouge">TMysqlDb</code> class</li>
  <li>PostgreSQL via <code class="highlighter-rouge">TPostgreSqlDb</code> class</li>
  <li>Firebird via <code class="highlighter-rouge">TFirebirdDb</code> class,</li>
  <li>SQLite via <code class="highlighter-rouge">TSQLiteDb</code> class</li>
</ul>

<h2 id="creating-database-connection">Creating Database Connection</h2>

<h3 id="mysql">MySQL</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var db : IRdbms;
...
db := TMySQLDb.create('MySQL 5.7');
db.connect('localhost', 'your_db_name', 'your_db_username', 'yoursecretpassword', 3306);
</code></pre></div></div>

<p>It will open database connection to MySQL 5.7 server on localhost on port 3306.</p>

<p>Replace <code class="highlighter-rouge">5.7</code> with your MySQL version, for example <code class="highlighter-rouge">5.5</code> to connect to MySQL 5.5 database server. Please note that string <code class="highlighter-rouge">MySQL 5.7</code> is compared case-insentively. So <code class="highlighter-rouge">MySQL 5.7</code> or <code class="highlighter-rouge">mysql 5.7</code> are same.</p>

<h3 id="postgresql">PostgreSQL</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var db : IRdbms;
...
db := TPostgreSqlDb.create();
db.connect('localhost', 'your_db_name', 'your_db_username', 'yoursecretpassword', 5432);
</code></pre></div></div>

<p>It will open database connection to PostgreSQL server on localhost on port 5432.</p>

<h3 id="firebird">Firebird</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var db : IRdbms;
...
db := TFirebirdDb.create();
db.connect('localhost', 'your_db_name', 'your_db_username', 'yoursecretpassword', 3050);
</code></pre></div></div>

<p>It will open database connection to Firebird server on localhost on port 3050.</p>

<h3 id="sqlite">SQLite</h3>

<p>SQLite is lightweight non client-server database engine. So you can leave host, port, username and password empty. Database name must be set to path where database file is stored.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var db : IRdbms;
...
db := TSQLiteDb.create();
db.connect('', 'your_data.db', '', '', 0);
</code></pre></div></div>

<p>It will open database connection which is stored in <code class="highlighter-rouge">your_data.db</code> file.</p>

<h2 id="executing-sql-query">Executing SQL Query</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var resultSet : IModelResultSet;
...
resultSet := db.prepare('SELECT * FROM users').execute();
</code></pre></div></div>

<h3 id="passing-parameters-to-sql-query">Passing parameters to SQL query</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resultSet := db.prepare('SELECT * FROM users WHERE user_email = :userEmail')
    .paramStr('userEmail', 'john@fanoframework.github.io')
    .execute();
</code></pre></div></div>

<h2 id="get-total-rows-in-result-set">Get total rows in result set</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var totData : integer;
...
totData := resultSet.resultCount();
</code></pre></div></div>

<h2 id="read-data-from-result-set">Read data from result set</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var userId : integer;
    userEmail : string;
...
userId := resultSet.fields().fieldByName('user_id').asInteger;
userEmail := resultSet.fields().fieldByName('user_email').asString;
</code></pre></div></div>

<h2 id="advance-cursor-to-next-position">Advance cursor to next position</h2>

<p><code class="highlighter-rouge">fields()</code> will read data in current cursor position. To read next data in result set, it is required that you call <code class="highlighter-rouge">next()</code> to advance cursor position.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resultSet.next();
</code></pre></div></div>

<h2 id="test-if-at-end-of-result-set">Test if at end of result set</h2>

<p><code class="highlighter-rouge">fieldByName()</code> method will throws exception if you try to read data when cursor is at end of file. To avoid it you need to check end of file condition with <code class="highlighter-rouge">eof()</code>. So to read all data in result set, you need following loop.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>while not resultSet.eof() do
begin
    userId := resultSet.fields().fieldByName('user_id').asInteger;
    //do something with userId
    resultSet.next();
end;
</code></pre></div></div>

<h2 id="executing-transaction">Executing Transaction</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.beginTransaction();
try
    //do multiple database operations
finally
    db.endTransaction();
end;
</code></pre></div></div>

<h2 id="explore-more">Explore more</h2>

<ul>
  <li><a href="/working-with-models">Working with Models</a></li>
</ul>

<ul class="actions">
    <li><a href="/documentation" class="button">Documentation</a></li>
</ul>

        </div>
    </section>
</div>


    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

</body>
</html>

