<!DOCTYPE html>
<!--
Hyperspace by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Working with Views - Fano Framework</title>
    <meta charset="utf-8" />
    <meta name="description" content="Tutorial on how to work with views in Fano Framework">
    <meta name="keywords" content="fano, web application, framework, pascal, programming, language, free pascal">
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="Working with Views"/>
    <meta property="og:site_name" content="Fano Framework"/>
    <meta property="og:url" content="http://localhost:4000/working-with-views/"/>
    <meta property="og:description" content="Tutorial on how to work with views in Fano Framework"/>
    <meta property="og:type" content="website"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">


<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">
        <nav>
            <ul>
                
                    <h3>Getting Started</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                          <li><a href="/tutorials">Step By Step Tutorials</a></li>
                        
                      </ul>
                
                    <h3>Basic</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                      </ul>
                
            </ul>
        </nav>
    </div>
</section>


<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">Working with Views</h1>

<h2 id="iview-interface">IView interface</h2>

<p>Interface <code class="highlighter-rouge">IView</code>, declared in unit <code class="highlighter-rouge">fano.pas</code>, is basis of view implementation in Fano Framework. It consists of <code class="highlighter-rouge">render()</code> method that implementor class must provide.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(*!------------------------------------------------
 * render view
 *------------------------------------------------
 * @param viewParams view parameters
 * @param response response instance
 * @return response
 *-----------------------------------------------*)
function render(
    const viewParams : IViewParameters;
    const response : IResponse
) : IResponse;

</code></pre></div></div>

<p>There are two input parameters:</p>

<ul>
  <li><code class="highlighter-rouge">viewParams</code> is class instance that implements <code class="highlighter-rouge">IViewParameters</code> interface. It
store any variable replacement. See <em>Working with view parameter</em> section in <a href="/working-with-views/displaying-data-in-view">Displaying Data in View</a> for more information.</li>
  <li><code class="highlighter-rouge">response</code> is class instance that implements <code class="highlighter-rouge">IResponse</code> interface. Read <a href="/working-with-response">Working with Response</a> for information about <code class="highlighter-rouge">IResponse</code>.</li>
</ul>

<p><code class="highlighter-rouge">render()</code> method expects that you will return response instance that will be used to render HTTP response.</p>

<h2 id="working-with-template">Working with template</h2>

<p>Fano provides some built-in classes implementing <code class="highlighter-rouge">IView</code> interface which you can use to work with HTML template to display web application response.</p>

<ul>
  <li><code class="highlighter-rouge">TView</code>, class that display view from HTML template string.</li>
  <li><code class="highlighter-rouge">TTemplateView</code>, class that display view from HTML template file.</li>
  <li><code class="highlighter-rouge">TCompositeView</code>, class that display view from two other <code class="highlighter-rouge">IView</code> instance. This is provided so we can compose several views as one. For example display
template consist of header, main content and footer.</li>
  <li><code class="highlighter-rouge">TNullView</code> class implements <code class="highlighter-rouge">IView</code> but does nothing. This class is provide
mostly in conjunction with TCompositeView</li>
</ul>

<h3 id="load-template-from-string">Load template from string</h3>

<p>Built-in <code class="highlighter-rouge">TView</code> class depends on instance of <code class="highlighter-rouge">ITemplateParser</code> interface and
and content of HTML template. <code class="highlighter-rouge">ITemplateParser</code> instance will be responsible to
parse variable placeholder, for example <code class="highlighter-rouge">[[varName]]</code>, in template with actual value.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var templateParser : ITemplateParser;
    view : IView;
...
templateParser:= TSimpleTemplateParser.create('[[', ']]');
view := TView.create(
    templateParser,
    '<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>Hello<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>' +
    '<span class="nt">&lt;body&gt;</span>Hello [[varName]]<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>'
);
</code></pre></div></div>

<p>If your HTML template does not contain any variable placeholders to be replaced with value, you can modify code above and replace <code class="highlighter-rouge">templateParser</code> with <code class="highlighter-rouge">TNullTemplateParser</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>templateParser:= TNullTemplateParser.create();
</code></pre></div></div>

<p>There is <code class="highlighter-rouge">TTemplateParser</code> class which does similar thing as <code class="highlighter-rouge">TSimpleTemplateParser</code>. <code class="highlighter-rouge">TTemplateParser</code> class utilizes regular expression
to replace variable placeholders and more flexible.</p>

<p>For example using <code class="highlighter-rouge">TTemplateParser</code> class, you can add whitespaces between open and closing tag, so <code class="highlighter-rouge">[[ varName ]]</code> and <code class="highlighter-rouge">[[varName]]</code> are considered same variable.</p>

<p><code class="highlighter-rouge">TSimpleTemplateParser</code> class replaces variable placeholders with exact
string replacement and only support <code class="highlighter-rouge">[[varName]]</code> format but it is faster because it does not use regular expression.</p>

<h3 id="load-template-from-single-html-file">Load template from single HTML file</h3>

<p>Fano comes with built-in utility to read file content and store it in
string with <code class="highlighter-rouge">IFileReader</code> interface. This interface has one method <code class="highlighter-rouge">readFile()</code> as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(*!------------------------------------------------
 * read file content to string
 *-----------------------------------------------
 * @param filePath path of file to be read
 * @return file content
 *-----------------------------------------------*)
function readFile(const filePath : string) : string;
</code></pre></div></div>

<p>To initialize <code class="highlighter-rouge">IView</code> from HTML template file, you can use following code snippet.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var fileReader : IFileReader;
    templateParser : ITemplateParser;
    view : IView;
...
templateParser:= TSimpleTemplateParser.create('[[', ']]');
fileReader:= TStringFileReader.create();
view := TView.create(
    templateParser,
    fileReader.readFile(
        '/path/to/templates/file.html'
    )
);
</code></pre></div></div>

<p>While <code class="highlighter-rouge">TView</code> can load HTML from file, <code class="highlighter-rouge">TTemplateView</code> is provided to simplify little bit,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
view := TTemplateView.create(
    '/path/to/templates/file.html'
    templateParser,
    fileReader
);
</code></pre></div></div>

<h2 id="compose-view-from-several-views">Compose view from several views</h2>

<p>Fano has <code class="highlighter-rouge">TCompositeView</code>, built-in class that implements <code class="highlighter-rouge">IView</code> interface which render view from two <code class="highlighter-rouge">IView</code> interface instances.</p>

<p>For example, if you have following HTML template structure</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- start of header part --&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- end of header part --&gt;</span>

<span class="c">&lt;!-- main content --&gt;</span>

<span class="c">&lt;!-- start footer part --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="c">&lt;!-- end footer part --&gt;</span>
</code></pre></div></div>

<p>where header part and footer part mostly similar between pages.</p>

<p>You can create <code class="highlighter-rouge">IView</code> instances that render header, main content and footer
and then compose them as one view with <code class="highlighter-rouge">TCompositeView</code>.</p>

<h3 id="header-part">Header part</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var headerView : IView;
...
headerView := TView.create(
    templateParser,
    '<span class="c">&lt;!-- start of header part --&gt;</span>' +
    '<span class="nt">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;</span>' +
    '<span class="c">&lt;!-- end of header part --&gt;</span>'
);
</code></pre></div></div>

<h3 id="footer-part">Footer part</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var footerView : IView;
...
footerView := TView.create(
    templateParser,
    '&lt;!-- start footer part --&gt;' +
    '&lt;/body&gt;&lt;/html&gt;' +
    '&lt;!-- end footer part --&gt;'
);
</code></pre></div></div>

<h3 id="main-content-part">Main content part</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var contentView : IView;
...
contentView := TView.create(
    templateParser,
    '&lt;!-- main content part --&gt;'
);
</code></pre></div></div>

<h3 id="composed-view">Composed view</h3>

<p><code class="highlighter-rouge">TCompositeView</code> supports composing two views. To compose more than two views you need to daisy-chained them, for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uses fano;
...
var view : IView;
...
view := TCompositeView.create(
    TCompositeView.create(headerView, contentView)
    footerView
);
</code></pre></div></div>

<h2 id="compose-view-from-one-or-more-view-partials">Compose view from one or more view partials</h2>

<p>View partial is basically any class which implements <code class="highlighter-rouge">IViewPartial</code> interface. This interface has only one method <code class="highlighter-rouge">partial()</code> that implementor must provide.
Given template path and view parameters, <code class="highlighter-rouge">partial()</code> method implementation must returns view content as string with any variable placeholders replaced with actual values.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(*!------------------------------------------------
 * read template file, parse and replace its variable
 * and output to string
 *-----------------------------------------------
 * @param templatePath file path of template
 * @param viewParams instance contains view parameters
 * @return string which all variables replaced with value from
 *        view parameters
 *-----------------------------------------------*)
function partial(
    const templatePath : string;
    const viewParams : IViewParameters
) : string;
</code></pre></div></div>

<p>See <em>Working with view parameter</em> section in <a href="/working-with-views/displaying-data-in-view">Displaying Data in View</a> for information how to work with <code class="highlighter-rouge">IViewParameters</code>.</p>

<p>For example, if you have following HTML template structure</p>

<p><code class="highlighter-rouge">/path/to/templates/main.template.html</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="c">&lt;!--[topCssJs]--&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!--[navbar]--&gt;</span>
<span class="c">&lt;!--[content]--&gt;</span>
<span class="c">&lt;!--[footerJs]--&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">/path/to/templates/top.css.js.html</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;title&gt;Hello&lt;/title&gt;
</code></pre></div></div>

<p><code class="highlighter-rouge">/path/to/templates/navbar.html</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ul&gt;
&lt;li&gt;Home&lt;/li&gt;
&lt;/ul&gt;
</code></pre></div></div>

<p><code class="highlighter-rouge">/path/to/templates/footer.html</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;This is Footer&lt;/div&gt;
</code></pre></div></div>

<p>You can create main view class,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(*!------------------------------------------------
 * render view
 *------------------------------------------------
 * @param viewParams view parameters
 * @param response response instance
 * @return response
*-----------------------------------------------*)
function TMainView.render(
    const viewParams : IViewParameters;
    const response : IResponse
) : IResponse;
begin
    viewParams.setVar(
        'topCssJs',
        fViewPartial.partial(
            '/path/to/templates/top.css.js.html',
            viewParams
        )
    );

    viewParams.setVar(
        'navbar',
        fViewPartial.partial(
            '/path/to/templates/navbar.html',
            viewParams
        )
    );

    viewParams.setVar(
        'footerJs',
        fViewPartial.partial(
            '/path/to/templates/footer.js.html',
            viewParams
        )
    );

    response.body().write(fTemplateParser.parse(fTemplateStr, viewParams));
    result := response;
end;

</code></pre></div></div>

<p>and create main view instance as follows,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var mainView : IView;

mainView := TMainView.create(
    '/path/to/templates/main.template.html'
    templateParser,
    fileReader
);

</code></pre></div></div>

<p>When main view is rendered by <code class="highlighter-rouge">TMyController</code> inherited from base class <a href="https://github.com/fanoframework/fano/blob/master/src/Mvc/Controllers/ControllerImpl.pas"><code class="highlighter-rouge">TController</code></a>, as follows</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type

    TMyController = class(TController)
    public
        function handleRequest(
            const request : IRequest;
            const response : IResponse
        ) : IResponse; override;
    end;

...

function TMyController.handleRequest(
    const request : IRequest;
    const response : IResponse
) : IResponse;
begin
    viewParams.setVar('content', '&lt;p&gt;Hello World&lt;/p&gt;');
    inherited handleRequest(request, response);
end;
</code></pre></div></div>

<p>It will output HTML response as follows</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="nt">&lt;li&gt;</span>Home<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello World<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;div&gt;</span>This is Footer<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h2 id="built-in-view-partial-implementation">Built-in view partial implementation</h2>

<p>Fano Framework provides two <code class="highlighter-rouge">IViewPartial</code> interface implementation</p>

<ul>
  <li><a href="https://github.com/fanoframework/fano/blob/master/src/Mvc/Views/ViewPartialImpl.pas"><code class="highlighter-rouge">TViewPartial</code></a>, this class loads template from file, replace any variable placeholders and output it as string.</li>
  <li><a href="https://github.com/fanoframework/fano/blob/master/src/Mvc/Views/StrViewPartialImpl.pas"><code class="highlighter-rouge">TStrViewPartial</code></a>, it is similar as above but loads template from string.</li>
</ul>

<h2 id="explore-more">Explore more</h2>

<ul>
  <li><a href="/working-with-views/displaying-data-in-view">Displaying Data in View</a></li>
  <li><a href="/working-with-controllers">Working with Controllers</a></li>
</ul>

<ul class="actions">
    <li><a href="/documentation" class="button">Documentation</a></li>
</ul>

        </div>
    </section>
</div>


    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

</body>
</html>

