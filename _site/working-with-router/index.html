<!DOCTYPE html>
<!--
Hyperspace by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Working with Router - Fano Framework</title>
    <meta charset="utf-8" />
    <meta name="description" content="Tutorial on how to work with router in Fano Framework">
    <meta name="keywords" content="fano, web application, framework, pascal, programming, language, free pascal">
    <meta name="robots" content="index, follow"/>
    <meta property="og:title" content="Working with Router"/>
    <meta property="og:site_name" content="Fano Framework"/>
    <meta property="og:url" content="http://localhost:4000/working-with-router/"/>
    <meta property="og:description" content="Tutorial on how to work with router in Fano Framework"/>
    <meta property="og:type" content="website"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">


<!-- Sidebar -->
<section id="sidebar">
    <div class="inner">
        <nav>
            <ul>
                
                    <h3>Getting Started</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                          <li><a href="/tutorials">Step By Step Tutorials</a></li>
                        
                      </ul>
                
                    <h3>Basic</h3>
                      <ul class="alt">
                        
                          <li><a href="/getting-started">Getting Started</a></li>
                        
                      </ul>
                
            </ul>
        </nav>
    </div>
</section>


<!-- Wrapper -->
<div id="wrapper">
    <!-- Main -->
    <section id="main" class="wrapper">
        <div class="inner">
            <h1 class="major">Working with Router</h1>

<h2 id="what-is-router">What is router?</h2>

<p>In Fano Framework, router is instance responsible to map a request to a code that handles it based on certain rule.</p>

<p>It is similar to front desk staff in a building. When a customer (request) comes in to building looking for an accounting staff (URL), first, she/he checks standard operational procedure (rule) to check whether is ok for outsider to contact accounting staff. If there are rule allows it, she/he directs the customer to accounting departement.</p>

<p>Similarly, when HTTP request is made to server, router determines code to handle request based on URL and HTTP method.</p>

<h2 id="about-route">About route</h2>

<p>In Fano Framework, a route is an association rule between a request (identified by HTTP method and URL) and code that handles it.</p>

<p>If we have following route setup</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var
    router : IRouter;
    myAppHandler, anotherAppHandler : IRequestHandler;
...

//GET request
router.get('/my/app', myAppHandler);

//POST request
router.post('/another/app', anotherAppHandler);
</code></pre></div></div>

<p>If client opens <code class="highlighter-rouge">http://[app hostname]/my/app</code> through browser, our application will receive request <code class="highlighter-rouge">GET</code> method to <code class="highlighter-rouge">/my/app</code> resources. Router will match HTTP method and URL and returns <code class="highlighter-rouge">myAppHandler</code> as code that responsible to handle this request.</p>

<p>If client opens <code class="highlighter-rouge">http://[app hostname]/another/app</code> through browser, our application will receive request <code class="highlighter-rouge">GET</code> method to <code class="highlighter-rouge">/another/app</code> resources. Router will find match to <code class="highlighter-rouge">/another/app</code> but because it is only registered for <code class="highlighter-rouge">POST</code> request, exception <code class="highlighter-rouge">EMethodNotAllowed</code> will be raised.</p>

<p>If client opens <code class="highlighter-rouge">http://[app hostname]/not/exists</code> through browser, our application will receive request <code class="highlighter-rouge">GET</code> method to <code class="highlighter-rouge">/not/exists</code> resources. Router will not find any matches. If this happens, exception <code class="highlighter-rouge">EMethodNotAllowed</code> will be raised.</p>

<h2 id="create-router-instance">Create router instance</h2>

<p>Fano Framework comes with basic router implementation <code class="highlighter-rouge">TRouter</code> class which implements <code class="highlighter-rouge">IRouter</code> interface.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>container.add('router', TSimpleRouterFactory.create());
</code></pre></div></div>

<h2 id="create-route">Create route</h2>

<h3 id="creating-route-for-get-method">Creating route for GET method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var
    router : IRouter;
    handler : IRequestHandler;
...
router.get('/', handler);
</code></pre></div></div>

<h3 id="creating-route-for-post-method">Creating route for POST method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.post('/submit', handler);
</code></pre></div></div>

<h3 id="creating-route-for-put-method">Creating route for PUT method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.put('/submit', handler);
</code></pre></div></div>

<h3 id="creating-route-for-delete-method">Creating route for DELETE method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.delete('/submit', handler);
</code></pre></div></div>

<h3 id="creating-route-for-patch-method">Creating route for PATCH method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.patch('/submit', handler);
</code></pre></div></div>

<h3 id="creating-route-for-head-method">Creating route for HEAD method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.head('/', handler);
</code></pre></div></div>

<h3 id="creating-route-for-options-method">Creating route for OPTIONS method</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.options('/', handler);
</code></pre></div></div>

<h3 id="creating-route-for-multiple-methods">Creating route for multiple methods</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.map(['GET', 'POST'], '/', handler);
</code></pre></div></div>

<h3 id="creating-route-for-all-methods">Creating route for all methods</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>router.any('/', handler);
</code></pre></div></div>

<h2 id="set-route-name-or-middlewares-with-iroute-interface">Set route name or middlewares with IRoute interface</h2>

<p>All methods which register request handler such as <code class="highlighter-rouge">get()</code>, <code class="highlighter-rouge">post()</code>,.. etc returns
instance of <code class="highlighter-rouge">IRoute</code> interface which you can use to assign name to route or attach a middlewares. Following code lists all methods in this interface.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function setName(const routeName : shortstring) : IRoute;
function getName() : shortstring;
function before(const amiddleware : IMiddleware) : IRoute;
function after(const amiddleware : IMiddleware) : IRoute;
</code></pre></div></div>

<p>For example to set route name and attach a middleware.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var authOnlyMiddleware : IMiddleware;
...
router.post('/user/submit', handler).setName('create-user').before(authOnlyMiddleware);
</code></pre></div></div>

<p>Read <a href="/middlewares">Middlewares</a> for more information.</p>

<h2 id="getting-route-argument">Getting route argument</h2>

<p>Third parameter of <code class="highlighter-rouge">handleRequest()</code> method of <code class="highlighter-rouge">IRequestHandler</code> interface gives instance of <code class="highlighter-rouge">IRouteArgsReader</code> interface to allow application to retrieve route argument.</p>

<p>If you have route pattern <code class="highlighter-rouge">/myroute/{name}</code> and you access route via URl <code class="highlighter-rouge">http://[your-host-name]/myroute/john</code> then you can get value of <code class="highlighter-rouge">name</code> parameter as follows</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function TMyController.handleRequest(
    const request : IRequest;
    const response : IResponse;
    const args : IRouteArgsReader
) : IResponse;
var
    arg : TPlaceholder;
begin
    arg := args.getArg('name');
    //arg.name = 'name', arg.value = 'john'
end;
</code></pre></div></div>

<p>You can get all route arguments using <code class="highlighter-rouge">getArgs()</code> method,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function TMyController.handleRequest(
    const request : IRequest;
    const response : IResponse;
    const args : IRouteArgsReader
) : IResponse;
var placeHolders : TArrayOfPlaceholders;
    arg : TPlaceholder;
    i:integer;
begin
    placeHolders := args.getArgs();

    for i:=0 to length(placeholders)-1 do
    begin
        arg := placeholders[i];
    end;
end;
</code></pre></div></div>

<p>See <a href="https://github.com/fanoframework/fano-app/blob/master/app/App/Hello/Controllers/HelloController.pas">code example</a> how to read route argument.</p>

<h2 id="explore-more">Explore more</h2>

<ul>
  <li><a href="/dispatcher">Dispatcher</a></li>
  <li><a href="/middlewares">Middlewares</a></li>
</ul>

<ul class="actions">
    <li><a href="/documentation" class="button">Documentation</a></li>
</ul>

        </div>
    </section>
</div>


    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery.scrollex.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/browser.min.js"></script>
    <script src="/assets/js/breakpoints.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/main.js"></script>

</body>
</html>

